<?xml version="1.0" encoding="UTF-8"?>
<changeSet>

  <!--================================================================================================-->
  <!-- REPOSITORY_NODE_STATUS -->
  <!--================================================================================================-->
  <createTable tableName="REPOSITORY_NODE_STATUS">
    <column name="NODE_URL" type="varchar(200)" nullable="false"/>
    <column name="LAST_UPDATE_TIME" type="bigint" nullable="false"/>
    <column name="DISK_USAGE" type="decimal(3, 2)" nullable="false"/>
  </createTable>

  <addPrimaryKey constraintName="IDX_REPOSITORY_NODE_STATUS_PK" tableName="REPOSITORY_NODE_STATUS" columnNames="NODE_URL"/>

  <!--================================================================================================-->
  <!-- REPOSITORY -->
  <!--================================================================================================-->
  <createTable tableName="REPOSITORY">
    <column name="REPOSITORY_NAME" type="varchar(200)" nullable="false"/>
    <column name="PRIMARY_NODE" type="varchar(200)" nullable="true"/>
  </createTable>

  <addPrimaryKey constraintName="IDX_REPOSITORY_PK" tableName="REPOSITORY" columnNames="REPOSITORY_NAME"/>
  <addForeignKeyConstraint constraintName="IDX_REPOSITORY_FK0" baseTableName="REPOSITORY" baseColumnNames="PRIMARY_NODE" referencedTableName="REPOSITORY_NODE_STATUS" referencedColumnNames="NODE_URL"/>

  <!--================================================================================================-->
  <!-- REPOSITORY_NODE -->
  <!--================================================================================================-->
  <createTable tableName="REPOSITORY_NODE">
    <column name="NODE_URL" type="varchar(200)" nullable="false"/>
    <column name="REPOSITORY_NAME" type="varchar(200)" nullable="false"/>
    <column name="STATUS" type="varchar(100)" nullable="false"/>
  </createTable>

  <addPrimaryKey constraintName="IDX_REPOSITORY_NODE_PK" tableName="REPOSITORY_NODE" columnNames="NODE_URL, REPOSITORY_NAME"/>
  <addForeignKeyConstraint constraintName="IDX_REPOSITORY_NODE_FK0" baseTableName="REPOSITORY_NODE" baseColumnNames="NODE_URL" referencedTableName="REPOSITORY_NODE_STATUS" referencedColumnNames="NODE_URL"/>
  <addForeignKeyConstraint constraintName="IDX_REPOSITORY_NODE_FK1" baseTableName="REPOSITORY_NODE" baseColumnNames="REPOSITORY_NAME" referencedTableName="REPOSITORY" referencedColumnNames="REPOSITORY_NAME"/>

</changeSet>